mkdir -p configs
cat <<EOF > configs/ddr4_config.yaml
MemorySystem:
  impl: GenericMemorySystem
  DRAM:
    impl: DDR4
    org:
      preset: DDR4_8Gb_x8
      channel: 1
      rank: 1
    timing:
      preset: DDR4_2400R
    voltage:
      preset: DDR4_1_2V
  Controller:
    impl: Generic
    Scheduler:
      impl: FCFS
    RefreshManager:
      impl: AllBank
EOF

# 1. Find the specific name of the Conda compiler (it won't be called just 'g++')
COMPILER=$(find $CONDA_PREFIX/bin -name "*-g++" | head -n 1)

if [ -z "$COMPILER" ]; then
    echo "‚ùå Compiler not found in Conda!"
    echo "Please run: conda install -y -c conda-forge gxx_linux-64"
    exit 1
fi

echo "‚úÖ Using compiler: $COMPILER"

# 2. Run the build using that specific compiler
"$COMPILER" -shared -fPIC -o libramulator_wrapper.so \
    src/wrapper.cpp \
    -I ramulator2/src \
    -L ramulator2/build \
    -L ramulator2/build/src \
    -lramulator2 \
    -Wl,-rpath,$(pwd)/ramulator2/build/src \
    -O3

# 3. Check if it worked
if [ -f "libramulator_wrapper.so" ]; then
    echo "üéâ SUCCESS! Library built."
else
    echo "‚ùå Build failed."
fi



g++ -shared -fPIC -o libramulator_wrapper.so \
    src/wrapper.cpp \
    -I ramulator2/src \
    -L ramulator2/build \
    -L ramulator2/build/src \
    -lramulator \
    -Wl,-rpath,$(pwd)/ramulator2/build/src \
    -Wl,-rpath,$(pwd)/ramulator2/build \
    -O3
